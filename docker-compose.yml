version: '3.8'

services:
  embassy-eye:
    build: .
    container_name: embassy-eye
    # IMPORTANT: Uncomment the line below if your VPN is running on the host
    # This allows the container to use the host's VPN connection
    network_mode: "host"
    environment:
      # Telegram configuration - set these in .env file or override here
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN}
      - TELEGRAM_USER_ID=${TELEGRAM_USER_ID}
      # Database configuration
      # When using network_mode: host, connect to localhost
      - DATABASE_URL=${DATABASE_URL:-postgresql://embassy_user:embassy_pass@localhost:5432/embassy_eye}
      - DB_ECHO=${DB_ECHO:-false}
    env_file:
      - .env
    volumes:
      # Mount screenshots directory to persist HTML files
      - ./screenshots:/app/screenshots
      # Mount project root to persist captcha_cooldown.json and allow code access
      # Note: Python packages are installed system-wide, so they remain available
      - .:/app
    # Uncomment to run on a schedule (requires cron or similar)
    # restart: unless-stopped

